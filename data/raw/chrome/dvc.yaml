vars:
  - ../../../params.yaml

stages:
  import:
    foreach:
      - http.0
      - http.1
      - http.2
      - http.3
      - http.4
      - http.5
    do:
      cmd: >-
        python3 ../../../src/transformer/parse_raw_data.py
        ${browsers.chrome}
        ${dir_name.date_one}
        ${item}
      deps:
        - ../../../src/transformer/parse_raw_data.py
        - ${dir_name.date_one}/${item}.json.gzip
      outs:
        - ../../../data/interim/${browsers.chrome}/${dir_name.date_one}/${item}.parquet.gzip

  train_test_split:
    cmd: >-
      python3 ../../../src/transformer/train_test_split.py
      ${browsers.chrome}
      ${dir_name.date_one}
      http.0
      0
      http.1
      1
    deps:
      - ../../../src/transformer/train_test_split.py
      - ../../../data/interim/${browsers.chrome}/${dir_name.date_one}/http.0.parquet.gzip
      - ../../../data/interim/${browsers.chrome}/${dir_name.date_one}/http.1.parquet.gzip
    outs:
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/train_set_01.parquet.gzip
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/test_set_01.parquet.gzip

#  resampling:
#    cmd: >-
#      python3 ../../../src/transformer/resampling_train_set.py
#      ${browsers.chrome}
#      ${dir_name.date_one}
#      01
#    deps:
#      - ../../../src/transformer/resampling_train_set.py
#      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/train_set_01.parquet.gzip
#    outs:
#      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/train_set_01_resampled.parquet.gzip

  pre_processing:
    cmd: >-
      python3 ../../../src/transformer/data_preprocessing.py
      ${browsers.chrome}
      ${dir_name.date_one}
    deps:
      - ../../../src/transformer/data_preprocessing.py
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/train_set_01.parquet.gzip
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/test_set_01.parquet.gzip
    outs:
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/train_set_01_processed.parquet.gzip
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/test_set_01_processed.parquet.gzip

  feature_engineering:
    cmd: >-
      python3 ../../../src/transformer/feature_engineering.py
      ${browsers.chrome}
      ${dir_name.date_one}
    deps:
      - ../../../src/transformer/feature_engineering.py
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/train_set_01_processed.parquet.gzip
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/test_set_01_processed.parquet.gzip
    outs:
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/train_set_01_featurized.parquet.gzip
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/test_set_01_featurized.parquet.gzip

  model_training:
    cmd: >-
      python3 ../../../src/models/train_model.py
      ${browsers.chrome}
      ${dir_name.date_one}
    deps:
      - ../../../src/models/train_model.py
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/train_set_01_featurized.parquet.gzip
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/test_set_01_featurized.parquet.gzip
    outs:
      - ../../../models/${browsers.chrome}/${dir_name.date_one}/random_forest_v2_binary.sav