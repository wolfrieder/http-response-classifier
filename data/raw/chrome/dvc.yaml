vars:
  - ../../../params.yaml

stages:
  merge:
    cmd: >-
      python3 ../../../src/transformer/merge_jsons.py
      ${data.raw_dir}
      ${data.merged_dir}
    deps:
      - ../../../src/transformer/merge_jsons.py
      - ${data.raw_dir}
    outs:
      - ${data.merged_dir}/merged_data.json.gz

  parse_to_parquet:
    cmd: >-
      python3 ../../../run_pipeline.py parse_raw_data.py
      ${browsers.chrome}
      ${dir_name.date_two}
      merged_data
      processed
    deps:
      - ../../../run_pipeline.py
      - ../../../src/transformer/parse_raw_data.py
      - ../../../src/pipeline_functions/parse_raw_data_functions.py
      - ../../../data/merged/chrome/${dir_name.date_two}/merged_data.json.gz
    outs:
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_two}/merged_data.parquet.gzip
#
#  train_test_split:
#    cmd: >-
#      python3 ../../../src/transformer/train_test_split.py
#      ${browsers.chrome}
#      ${dir_name.date_one}
#      http.0
#      0
#      http.1
#      1
#    deps:
#      - ../../../src/transformer/train_test_split.py
#      - ../../../data/interim/${browsers.chrome}/${dir_name.date_one}/http.0.parquet.gzip
#      - ../../../data/interim/${browsers.chrome}/${dir_name.date_one}/http.1.parquet.gzip
#    outs:
#      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/train_set_01.parquet.gzip
#      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/test_set_01.parquet.gzip

  pre_processing:
    cmd: >-
      python3 ../../../run_pipeline.py data_preprocessing.py
      ${browsers.chrome}
      ${dir_name.date_one}
      train_set_01
      ${browsers.chrome}
      ${dir_name.date_two}
      merged_data
      other
#      test_set_01
#      same
    deps:
      - ../../../run_pipeline.py
      - ../../../src/pipeline_functions/data_preprocessing_functions.py
      - ../../../src/transformer/data_preprocessing.py
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/train_set_01.parquet.gzip
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_two}/merged_data.parquet.gzip
#      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/test_set_01.parquet.gzip
    outs:
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/train_set_01_processed.parquet.gzip
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_two}/merged_data_processed.parquet.gzip
#      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/test_set_01_processed.parquet.gzip

  feature_engineering:
    cmd: >-
      python3 ../../../run_pipeline.py feature_engineering.py
      ${browsers.chrome}
      ${dir_name.date_one}
      train_set_01_processed
      ${browsers.chrome}
      ${dir_name.date_two}
      merged_data_processed
      binary_encoding
#      test_set_01_processed
    deps:
      - ../../../run_pipeline.py
      - ../../../src/pipeline_functions/feature_engineering_functions.py
      - ../../../src/features/feature_engineering.py
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/train_set_01_processed.parquet.gzip
#      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/test_set_01_processed.parquet.gzip
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_two}/merged_data_processed.parquet.gzip
    outs:
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/train_set_01_featurized_BE.parquet.gzip
#      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/test_set_01_featurized_BE.parquet.gzip
      - ../../../data/processed/${browsers.chrome}/${dir_name.date_two}/merged_data_featurized_BE.parquet.gzip

#  model_training:
#    cmd: >-
#      python3 ../../../run_pipeline.py train_model.py
#      ${browsers.chrome}
#      ${dir_name.date_one}
#      train_set_01_featurized_BE
#      binary
#      chrome_old_BE
#    deps:
#      - ../../../src/models/train_model.py
#      - ../../../data/processed/${browsers.chrome}/${dir_name.date_one}/train_set_01_featurized_BE.parquet.gzip
#    outs:
#      - ../../../models/result_metrics/chrome_old_BE.csv
#      - ${dir_paths.chrome_old_models}/Logistic_Regression_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/Gaussian_NB_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/Bernoulli_NB_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/Decision_Tree_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/Random_Forest_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/Extra_Trees_Classifier_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/Ada_Boost_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/Gradient_Boosting_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/LightGBM_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/Hist_GB_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/XGBoost_BE.sav.gz
#
#  model_evaluation:
#    cmd: >-
#      python3 ../../../run_pipeline.py test_model.py
#      ${browsers.chrome}
#      ${dir_name.date_two}
#      merged_data_featurized_BE
#      chrome_new_BE
#    deps:
#      - ../../../src/models/test_model.py
#      - ../../../data/processed/${browsers.chrome}/${dir_name.date_two}/merged_data_featurized_BE.parquet.gzip
#      - ${dir_paths.chrome_old_models}/Logistic_Regression_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/Gaussian_NB_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/Bernoulli_NB_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/Decision_Tree_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/Random_Forest_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/Extra_Trees_Classifier_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/Ada_Boost_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/Gradient_Boosting_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/LightGBM_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/Hist_GB_BE.sav.gz
#      - ${dir_paths.chrome_old_models}/XGBoost_BE.sav.gz
#    outs:
#      - ../../../models/result_metrics/chrome_new_BE.csv
#      - ../../../models/result_metrics/chrome_new_BE_CI.csv